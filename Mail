import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
#QQ邮箱服务器地址
mail_host = 'smtp.qq.com'
#用户名
mail_user = '1206064486'
#密码(部分邮箱为授权码)
mail_pass = 'ntidvudghbqgfjhg'
#邮件发送方邮箱地址
sender = '1206064486@qq.com'
#邮件接受方邮箱地址
receivers = ['17612179607@126.com']

subject = 'Python SMTP Test'
content = 'This is a SMTP test ...'

send_file = open(r"D:\File\上海分公司.xlsx",'rb').read()

att = MIMEText(send_file,'base64','utf-8')                     #调用传送附件模块，传送附件
att["Content-Type"] = 'application/octet-stream'
att.add_header('Content-Disposition', 'attachment', filename='上海分公司.xlsx') #附件描述

#构建发送与接收信息
msgRoot=MIMEMultipart()                             #发送附件的方法定义为一个变量
msgRoot.attach(MIMEText(content, 'html', 'utf-8'))  #发送附件的方法中嵌套发送正文的方法
msgRoot['subject']=subject
msgRoot['From']=sender
msgRoot['To'] = ','.join(receivers)
msgRoot.attach(att)                                 #添加附件到正文中

#SSL协议端口号要使用465
smtp = smtplib.SMTP_SSL(mail_host, 465)

#HELO 向服务器标识用户身份
smtp.helo(mail_host)
#服务器返回结果确认
smtp.ehlo(mail_host)
#登录邮箱服务器用户名和密码
smtp.login(sender,mail_pass)
print("Start send email...")
smtp.sendmail(sender,receivers,msgRoot.as_string())
smtp.quit()
print("Send End！")
